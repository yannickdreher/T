<wnd:AppWindow xmlns="https://github.com/avaloniaui"
			   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			   xmlns:vm="using:T.UI.ViewModels"
			   xmlns:components="using:T.UI.Views.Components"
			   xmlns:converters="using:T.UI.Converters"
			   xmlns:ui="using:FluentAvalonia.UI.Controls"
			   xmlns:svg="using:Avalonia.Svg.Skia"
			   xmlns:wnd="using:FluentAvalonia.UI.Windowing"
			   xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			   xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			   mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="700"
			   x:Class="T.UI.Views.MainWindow"
			   x:DataType="vm:MainWindowViewModel"
			   Title="T" Width="1200" Height="700" WindowState="Maximized"
			   Icon="avares://T/Assets/logo.ico">

	<!-- Design-Time DataContext -->
	<Design.DataContext>
		<vm:MainWindowViewModel/>
	</Design.DataContext>

	<wnd:AppWindow.Resources>
		<converters:ConnectionStatusToBrushConverter x:Key="StatusToBrush"/>
	</wnd:AppWindow.Resources>

	<Grid RowDefinitions="32,*" Margin="8,0,8,8">

		<StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
			<Image Width="20" Height="20" Source="avares://T/Assets/logo.ico"/>
			<Menu FontSize="12" VerticalAlignment="Center">
				<Menu.Styles>
					<Style Selector="MenuItem">
						<Setter Property="Padding" Value="2"/>
						<Setter Property="Height" Value="26"/>
					</Style>
				</Menu.Styles>

				<MenuItem Header="Settings" Command="{Binding ShowSettingsCommand}"/>
				<MenuItem Header="About" Click="OnAboutClick"/>
			</Menu>
		</StackPanel>

		<Grid Grid.Row="1" ColumnDefinitions="300,Auto,*">
			<!-- Left Sidebar - Sessions List -->
			<components:SessionsPanel Grid.Column="0"
									  DataContext="{Binding SessionsTree}"/>

			<GridSplitter Grid.Column="1"
						  Background="Transparent"
						  ResizeDirection="Columns"
						  ResizeBehavior="PreviousAndNext"/>

			<!-- Main Area - Tabbed Sessions -->
			<Border Grid.Column="2" Classes="Panel">
				<Grid RowDefinitions="*,Auto">

					<!-- Session Content (bound to ActiveSession) -->
					<Grid Grid.Row="0" IsVisible="{Binding SessionsTree.HasOpenSessions}">
						<Grid RowDefinitions="Auto,*">

							<!-- Tab Headers -->
							<ui:TabView Grid.Row="0"
										TabItems="{Binding SessionsTree.OpenSessions}"
										SelectedItem="{Binding SessionsTree.ActiveSession}"
										TabCloseRequested="OnTabCloseRequested"
										IsAddTabButtonVisible="False"
										TabWidthMode="SizeToContent"
										CloseButtonOverlayMode="OnPointerOver"
										TabStripFooter="{x:Null}">
								<ui:TabView.TabItemTemplate>
									<DataTemplate x:DataType="vm:SessionViewModel">
										<StackPanel Orientation="Horizontal" Spacing="6">
											<Ellipse Width="8" Height="8"
													 Fill="{Binding Session.ConnectionStatus, Converter={StaticResource StatusToBrush}}"/>
											<TextBlock Text="{Binding Session.Name}"/>
										</StackPanel>
									</DataTemplate>
								</ui:TabView.TabItemTemplate>
							</ui:TabView>

							<!-- Alle Sessions übereinander -->
							<ItemsControl Grid.Row="1" ItemsSource="{Binding SessionsTree.OpenSessions}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <Grid/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="vm:SessionViewModel">
                                        <ContentControl Content="{Binding}" IsVisible="{Binding IsActive}"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
						</Grid>
					</Grid>

					<!-- Welcome Screen (no sessions open) -->
					<StackPanel IsVisible="{Binding !SessionsTree.HasOpenSessions}"
								HorizontalAlignment="Center" VerticalAlignment="Center">
						<svg:Svg Path="/Assets/logo.svg" Width="160" Height="160"/>
						<TextBlock Text="Select a session and click 'Connect'"
								   Opacity="0.7" HorizontalAlignment="Center"/>
					</StackPanel>
				</Grid>
			</Border>
		</Grid>
	</Grid>
</wnd:AppWindow>
